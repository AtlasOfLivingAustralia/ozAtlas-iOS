

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <script src="static/t5OGphSUjwdNOoxNKgdRTTh1RBtmzhMXxHDYYeR4lYj.js" type="text/javascript" ></script>
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/VySgOjkVOsD8Jt8ujXROVRjZeDLAAwVhMF5WqPZ8Ajf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/Qwaw257M4sHcJuspEDRbeQoTceByqRmOCHNaZWpOxuc.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/doSKUivnfI9gXmPKZ2XG4W5xIABYgKaf5Dwf3LtjNVr.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/fx5pGfEFSRJi6nyez3s8fUsjDL8WJ0IB04Njm7T2VAJ.css" type="text/css" rel="stylesheet" media="all" />
<link href="static/iHX8x0PqEmsjgyBEeq6NRvjAytsYzmt25tsjtHoHXDq.css" type="text/css" rel="stylesheet" media="screen,print" />




<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/exPgH85S7hDuxmySlOZhM0sayvRJla83G3HHYJNzaUB.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/tNjfADEdRvZz6orXSyopLhQhlHwq7bH7hcAZQiGZMoc.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/RrjzrZ0Ci0GPLETIr8x8KUMjfJtZKvifrUtMCedwKRB.png" rel="shortcut icon" />
<link href="static/4zsVqykqBON8U5Es5kfffXBSGJlbI8VrPDW4hSn1SWJ.css" type="text/css" rel="stylesheet" media="screen, projection" />


<link href="static/sCFm7bBsIMFGQHTSlBbhMHQCXWhOsbBr5z4bu1OueIE.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/tUELnv7Uvq6ppWNUWOlaow3JGSTTIf8hJ2VYvh7Oahj.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/OKcRcjAeA1yuXD9r4fZA1Uw2HEwL7gYvjc6HdrZXIYP.png" rel="shortcut icon" />
<link href="/static/UxF0saaqmikaj74l2WFcCyPMm9hEEs8if7IBy0GNAnd.png" rel="shortcut icon" />
<link href="/static/zs4hrJqt7I802RlaZiXbmbDBarpNPZF8V8fCQJ2RVTM.png" rel="shortcut icon" />
<link href="/static/SvC1e8bSiCPFh8mObbEThgbJIaGZi72ATzqobK6QnnB.gif" rel="shortcut icon" />
<link href="/static/BA9MhIHZnH0zMcKJWIWsTurHhQTpDYE6akqM5excaZI.gif" rel="shortcut icon" />

<script type="text/javascript">
    var fcConfig = {
        bieUrl: "#",
        speciesProfileUrl: "https://fieldcapture-test.ala.org.au/proxy/speciesProfile",
        googleStaticUrl:"http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=350x250&markers=color:red%7C"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    
    
</if>

    <style type="text/css">
        input[type=checkbox] {  -webkit-transform: scale(1.5); }
        .checkbox-list label { min-height: 40px; }
        .speciesAutocompleteRow {min-height:40px;}
        .datepicker td, .datepicker th {
            width:40px;
            height:40px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">
                <div class="row-fluid">

                    <span class="span8">
                    <div class="row-fluid space-after">

                        <div class="span6 required">
                            <label for="startDate"><b>Actual start date</b>
                                <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>


                            <div class="input-append">
                                <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                        <div class="span6" data-bind="css:{required:transients.markedAsFinished}">
                            <label for="endDate"><b>Actual end date</b>
                                <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>

                            <div class="input-append">
                                <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                    </div>
                    <div class="row-fluid space-after">
                        <div class="span6">
                            <label for="theme"><b>Major theme</b></label>
                            <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge" style="width:90%">
                            </select>
                        </div>

                        <div class="span6">
                            <label><b>Progress</b></label>
                            <label for="activityComplete"><input type="checkbox" id="activityComplete" data-bind="checked:transients.markedAsFinished" style="margin-right:1em;"><span>This activity is complete</span></label>

                        </div>

                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="site"><b>Site</b></label>
                            <select id='site' style='width:90%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                        </div>

                        <div class="span3">

                            <button class="btn btn-info" style="margin-top:25px;" data-bind="visible:transients.newSiteSupported,click:createNewSite">Create new Site</button>
                        </div>
                    </div>

                    
                        
                            
                                
                            
                            
                                
                                    
                                    
                                    
                                    

                                
                            
                        

                    
                    </span>
                    <span class="span4">

                        <img id="siteLocationImage" width="100%" data-bind="event:{error:siteLoadError}, attr:{src:transients.siteImgUrl}, visible:transients.siteImgUrl()"/>


                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    
    <div class="output-block" id="koSampling_Site_Information">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Sampling Site Information</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Sampling_Site_Information-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span8">This form is used to record vegetation and site assessment information using the Biodiversity Fund Ecological Monitoring Methodology. The guide for this methodology is available from the Department of Environment website at <strong><a href='http://www.environment.gov.au/cleanenergyfuture/biodiversity-fund/meri/pubs/eco-monitoring-guide.pdf' target='_blank'>http://www.environment.gov.au/cleanenergyfuture/biodiversity-fund/meri/pubs/eco-monitoring-guide.pdf</a></a></strong>.<br>More information is also available on the Native Vegetation Information System (NVIS) at <strong><a href='http://www.environment.gov.au/topics/science-and-research/databases-and-maps/national-vegetation-information-system' target='_blank'>http://www.environment.gov.au/topics/science-and-research/databases-and-maps/national-vegetation-information-system</a></strong>, including maps and descriptions of the major vegetation groups and sub-groups</span></span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Recorder name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person responsible for recording and assuring the quality of the data record.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.recorderName'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Compass bearing of sampled transect (deg mag):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The compass bearing in magnetic degrees of the sampled transect from the starting position of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.transectBearing' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>What type of assessment event was this?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Is this an initial assessment of the site or not?'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.assessmentEventType,options:transients.assessmentEventTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>NVIS major vegetation group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Major vegetation group from the Native Vegetation Information system'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.nvisGroup,options:transients.nvisGroupConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>NVIS major vegetation sub-group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Major vegetation sub-group from the Native Vegetation Information system'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.nvisSubGroup,options:transients.nvisSubGroupConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>What type of site is this assessment being undertaken on?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Is this assessment on an intervention site (an area where intervention activities have been undertaken) or a control site (an area where intervention activities have not been undertaken)?'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.typeOfSite,options:transients.typeOfSiteConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>General Description / Comments / Notes:</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        </div>
        
    </div>
    

    

    
    
    
    <style type="text/css">
        table.groundCoverSamples th {white-space:normal;}
        table.groundCoverSamples tbody td:nth-child(1) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(1)
        table.groundCoverSamples tbody td:nth-child(2) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(2)
        table.groundCoverSamples tbody td:nth-child(3) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(3)
        table.groundCoverSamples tbody td:nth-child(4) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(4)
        table.groundCoverSamples tbody td:nth-child(5) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(5)
        table.groundCoverSamples tbody td:nth-child(6) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(6)
        table.groundCoverSamples tbody td:nth-child(7) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(7)
        table.groundCoverSamples tbody td:nth-child(8) {width:10%;text-align:center;}
        table.groundCoverSamples tbody td:nth-child(8)
        table.groundCoverSamples td:last-child {width:4%;text-align:center;}
        table.groundCoverSamples textarea {width:100%; box-sizing:border-box; }
        table.groundCoverSamples select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koField_Sheet_1_-_Ground_Cover">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 1 - Ground Cover</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Field_Sheet_1_-_Ground_Cover-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record all ground cover information at each sampling point (1m intervals) along the transect.</span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered groundCoverSamples " >
                <thead><tr><th>Point (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Distance in metres along the transect that a record is made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Native Plants<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual native plants touched by the staff within 1 metre of the ground at the sampling point '>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Exotic Plants<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual exotic plants touched by the staff within 1 metre of the ground at the sampling point '>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Cryptogram</th><th>Organic Litter</th><th>Bare ground</th><th>Rock</th><th>Water</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'groundCoverSamplesviewTmpl', foreach: data.groundCoverSamples}"></tbody>
                <script id="groundCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:sampleLocation'></span></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfNativePlants' data-validation-engine='validate[min[0],max[3],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfExoticPlants' data-validation-engine='validate[min[0],max[3],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input name='cryptogramPresent' data-bind='checked:cryptogramPresent' type='checkbox' class='checkbox'/></td>
                    <td><input name='organicLitterPresent' data-bind='checked:organicLitterPresent' type='checkbox' class='checkbox'/></td>
                    <td><input name='bareGroundPresent' data-bind='checked:bareGroundPresent' data-validation-engine='validate[groupRequired[rockOrBareGround]]' type='checkbox' class='checkbox'/></td>
                    <td><input name='rockPresent' data-bind='checked:rockPresent' data-validation-engine='validate[groupRequired[rockOrBareGround]]' type='checkbox' class='checkbox'/></td>
                    <td><input name='waterPresent' data-bind='checked:waterPresent' type='checkbox' class='checkbox'/></td>
                    <td><i data-bind='click:$root.removegroundCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                </tfoot>
            </table>
        </div>

        </div>
        
    </div>
    

    
    
    
    <style type="text/css">
        table.evidenceOfExoticFauna th {white-space:normal;}
        table.evidenceOfExoticFauna tbody td:nth-child(1) {width:10%;text-align:center;}
        table.evidenceOfExoticFauna tbody td:nth-child(1)
        table.evidenceOfExoticFauna tbody td:nth-child(2) {width:20%;}
        table.evidenceOfExoticFauna tbody td:nth-child(2)
        table.evidenceOfExoticFauna tbody td:nth-child(3) {width:60%;}
        table.evidenceOfExoticFauna tbody td:nth-child(3)
        table.evidenceOfExoticFauna td:last-child {width:4%;text-align:center;}
        table.evidenceOfExoticFauna textarea {width:100%; box-sizing:border-box; }
        table.evidenceOfExoticFauna select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koField_Sheet_2_-_Exotic_Fauna">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 2 - Exotic Fauna</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Field_Sheet_2_-_Exotic_Fauna-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record any evidence of the presence of exotic fauna that you find along the sampling transect. This is recorded as the type of evidence and distance along the transect, and any noteworthy observations associated with it.</span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered evidenceOfExoticFauna " >
                <thead><tr><th class="required">Point (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Distance in metres along the transect that a record is made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Evidence<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of evidence of the presence of exotic fauna observed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Comment</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'evidenceOfExoticFaunaviewTmpl', foreach: data.evidenceOfExoticFauna}"></tbody>
                <script id="evidenceOfExoticFaunaviewTmpl" type="text/html"><tr>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:sampleLocation' data-validation-engine='validate[required,min[0],max[50],custom[number]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:evidence,options:transients.evidenceConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><textarea  data-bind='value:comment'></textarea></td>
                    <td><i data-bind='click:$root.removeevidenceOfExoticFaunaRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addevidenceOfExoticFaunaRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="evidenceOfExoticFaunatemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="evidenceOfExoticFaunatemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        </div>
        
    </div>
    

    
    
    
    <style type="text/css">
        table.nativeOverstoreyCoverSamples th {white-space:normal;}
        table.nativeOverstoreyCoverSamples tbody td:nth-child(1) {text-align:center;}
        table.nativeOverstoreyCoverSamples tbody td:nth-child(2) {text-align:center;}
        table.nativeOverstoreyCoverSamples tbody td:nth-child(3) {text-align:center;}
        table.nativeOverstoreyCoverSamples td:last-child {width:4%;text-align:center;}
        table.nativeOverstoreyCoverSamples textarea {width:100%; box-sizing:border-box; }
        table.nativeOverstoreyCoverSamples select {width:100%; box-sizing:border-box; }
    </style><style type="text/css">
        table.exoticOverstoreyCoverSamples th {white-space:normal;}
        table.exoticOverstoreyCoverSamples tbody td:nth-child(1) {text-align:center;}
        table.exoticOverstoreyCoverSamples tbody td:nth-child(2) {text-align:center;}
        table.exoticOverstoreyCoverSamples tbody td:nth-child(3) {text-align:center;}
        table.exoticOverstoreyCoverSamples td:last-child {width:4%;text-align:center;}
        table.exoticOverstoreyCoverSamples textarea {width:100%; box-sizing:border-box; }
        table.exoticOverstoreyCoverSamples select {width:100%; box-sizing:border-box; }
    </style><style type="text/css">
        table.nativeMidstoreyCoverSamples th {white-space:normal;}
        table.nativeMidstoreyCoverSamples tbody td:nth-child(1) {text-align:center;}
        table.nativeMidstoreyCoverSamples tbody td:nth-child(2) {text-align:center;}
        table.nativeMidstoreyCoverSamples tbody td:nth-child(3) {text-align:center;}
        table.nativeMidstoreyCoverSamples td:last-child {width:4%;text-align:center;}
        table.nativeMidstoreyCoverSamples textarea {width:100%; box-sizing:border-box; }
        table.nativeMidstoreyCoverSamples select {width:100%; box-sizing:border-box; }
    </style><style type="text/css">
        table.exoticMidstoreyCoverSamples th {white-space:normal;}
        table.exoticMidstoreyCoverSamples tbody td:nth-child(1) {text-align:center;}
        table.exoticMidstoreyCoverSamples tbody td:nth-child(2) {text-align:center;}
        table.exoticMidstoreyCoverSamples tbody td:nth-child(3) {text-align:center;}
        table.exoticMidstoreyCoverSamples td:last-child {width:4%;text-align:center;}
        table.exoticMidstoreyCoverSamples textarea {width:100%; box-sizing:border-box; }
        table.exoticMidstoreyCoverSamples select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koField_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_Cover">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Field_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_Cover-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter information about the structure of the canopy and midstorey layers by recording the start and finish distances along the transect for each plant with projecting foliage. <br><strong>NB.: Only complete this section if the vegetation type has distinctive canopy and/or midstorey layers.</strong></span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h3>Transect (projected crown cover - overstorey species)</h3></span></span></div>
<div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Native overstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered nativeOverstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'nativeOverstoreyCoverSamplesviewTmpl', foreach: data.nativeOverstoreyCoverSamples}"></tbody>
                <script id="nativeOverstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removenativeOverstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total native overstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalNativeOverstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addnativeOverstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="nativeOverstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="nativeOverstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Exotic overstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered exoticOverstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'exoticOverstoreyCoverSamplesviewTmpl', foreach: data.exoticOverstoreyCoverSamples}"></tbody>
                <script id="exoticOverstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removeexoticOverstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total exotic overstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalExoticOverstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addexoticOverstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="exoticOverstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="exoticOverstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h3>Transect (projected crown cover - midstorey species)</h3></span></span></div>
<div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Native midstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered nativeMidstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'nativeMidstoreyCoverSamplesviewTmpl', foreach: data.nativeMidstoreyCoverSamples}"></tbody>
                <script id="nativeMidstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removenativeMidstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total native midstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalNativeMidstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addnativeMidstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="nativeMidstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="nativeMidstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Exotic midstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered exoticMidstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'exoticMidstoreyCoverSamplesviewTmpl', foreach: data.exoticMidstoreyCoverSamples}"></tbody>
                <script id="exoticMidstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removeexoticMidstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total exotic midstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalExoticMidstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addexoticMidstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="exoticMidstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="exoticMidstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div></div>

        </div>
        
    </div>
    

    
    
    
    <style type="text/css">
        table.crownTypeSamples th {white-space:normal;}
        table.crownTypeSamples tbody td:nth-child(2) {text-align:center;}
        table.crownTypeSamples tbody td:nth-child(3) {text-align:center;}
        table.crownTypeSamples td:last-child {width:4%;text-align:center;}
        table.crownTypeSamples textarea {width:100%; box-sizing:border-box; }
        table.crownTypeSamples select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koField_Sheet_4_-_Crown_Type">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 4 - Crown Type</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Field_Sheet_4_-_Crown_Type-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Locate up to 10 points along the transect that are each at least 3m apart and where the <strong>native overstorey canopy</strong> is directly overhead and other conditions specified in the Biodiversity Fund Ecological Monitoring Guide are met. Record the distance along the transect and the type of canopy (looking vertically) as a percentage - see Appendix B in the monitoring guide.</span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><b>Only complete this part if the vegetation type has a distinctive overstorey</b></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered crownTypeSamples " >
                <thead><tr><th></th><th>Distance along transect (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance from the origin along the sampling transect in metres at which canopy type percentage is recorded.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Crown Type (%)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The canopy foliage cover estimated using the Vegetation Assessment - commonwealth methodology, expressed as a percentage.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'crownTypeSamplesviewTmpl', foreach: data.crownTypeSamples}"></tbody>
                <script id="crownTypeSamplesviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:sampleName'></span></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:distanceAlongTransect' data-validation-engine='validate[min[0],max[50],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:crownType' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removecrownTypeSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Average crown type (%)</span></td>
                    <td><span  class="value" data-bind='text:data.averageCrownType'></span></td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
        </div>

        </div>
        
    </div>
    

    
    
    
    <style type="text/css">
        table.speciesList th {white-space:normal;}
        table.speciesList tbody td:nth-child(1) {width:80%;}
        table.speciesList tbody td:nth-child(1)
        table.speciesList tbody td:nth-child(2) {width:20%;}
        table.speciesList tbody td:nth-child(2)
        table.speciesList td:last-child {width:4%;text-align:center;}
        table.speciesList textarea {width:100%; box-sizing:border-box; }
        table.speciesList select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koField_Sheet_5_-_Species_Diversity">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 5 - Species Diversity</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Field_Sheet_5_-_Species_Diversity-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record all species present in the 20m x 20m plot marked out for this assessment.</span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><p>This sheet differs from the hard copy worksheet - it combines Field Sheet 5 & 6.  Please attempt to identify each species, in particular the exotics.</p></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered speciesList " >
                <thead><tr><th class="required">Species<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species present at the site.  If not identified, select "Unknown or unlisted species" from the list'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Native/Exotic<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Specifies whether the species is native to the site or exotic'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'speciesListviewTmpl', foreach: data.speciesList}"></tbody>
                <script id="speciesListviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched' || listId() == 'error-unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'https://fieldcapture-test.ala.org.au/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><select data-bind='value:nativeOrExotic,options:transients.nativeOrExoticConstraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removespeciesListRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="3" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addspeciesListRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="speciesListtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="speciesListtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        </div>
        
    </div>
    

<!-- /ko -->

</div>




</div>

<script src="static/Zbj0J8XhmZDqWqIAz5C46TWLOULGl7LNvdJeBlO9fMb.js" type="text/javascript" ></script>





<script src="static/5zeDycYZFxJsfDd3W1kuhrN47XnIMrbhS6gdHDvcExv.js" type="text/javascript" ></script>

<script src="static/ulxBmo4RrKTNT3DuFHethb4EOZpwQfvefxNXivDIbzp.js" type="text/javascript" ></script>








<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/nRrltgvxdEHd5BqRR1v4XU3ZStOrhDScuH03g4r8E6O.js" type="text/javascript" ></script>

<script src="static/zP22SFJVnKXoWuBJdbsNhcivH2iXiC57wEOHXSDNudf.js" type="text/javascript" ></script>

<script src="static/QjmKsgTA1QWYxF0gcpdSFROG8mBnzaabMZcvDxBb9Xo.js" type="text/javascript" ></script>






<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script src="static/I4NiLd8qMXMMgs4hAqHb5YT0jGlQhM4Yp0dku4W1Wng.js" type="text/javascript" ></script>



<script src="static/e9gGniNN5cG3OR4oPVWd5lYoxE5Xf282hFe7d4FTQbq.js" type="text/javascript" ></script>


<script src="static/CRNxISj7t7ZCV7B8M8dFtBK7x7R4tGVO36INoBz8gQX.js" type="text/javascript" ></script>

<script src="static/QhlSgFWjl35vcaCRa5cKxHZxRWSSluzptQUKz3PHr9s.js" type="text/javascript" ></script>


<script src="static/8WCQyXwicnBgTdLQ4F5jUFtmVXmqG9eUZKvo74wOnIT.js" type="text/javascript" ></script>
<script src="static/9HtLc6nfgO9H72LVVZxetW45ZR623Fx8EhEdydgOq2F.js" type="text/javascript" ></script>
<script src="static/wkrwT3eqoZlWXFPCQRTvkdsdvwzT5Lw2H89f9eTkQdb.js" type="text/javascript" ></script>


<script type="text/javascript">
        $(function(){

            var viewModelName = "Sampling_Site_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Sampling Site Information";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.recorderName = ko.observable();

            self.data.transectBearing = ko.observable();

            self.data.nvisGroup = ko.observable();
            self.transients.nvisGroupConstraints = ["MVG 1 - Rainforests and Vine Thickets","MVG 2 - Eucalypt Tall Open Forests","MVG 3 - Eucalypt Open Forests","MVG 4 - Eucalypt Low Open Forests","MVG 5 - Eucalypt Woodlands","MVG 6 - Acacia Forests and Woodlands","MVG 7 - Callitris Forests and Woodlands","MVG 8 - Casuarina Forests and Woodlands","MVG 9 - Melaleuca Forests and Woodlands","MVG 10 - Other Forests and Woodlands","MVG 12 - Tropical Eucalypt Woodlands/Grasslands","MVG 14 - Mallee Woodlands and Shrublands","MVG 30 - Unclassified Forest","MVG 11 - Eucalypt Open Woodlands","MVG 13 - Acacia Open Woodlands","MVG 32 - Mallee Open Woodlands and Sparse Mallee Shrublands","MVG 31 - Other Open Woodlands","MVG 15 - Low Closed Forests and Tall Closed Shrublands","MVG 16 - Acacia Shrublands","MVG 17 - Other Shrublands","MVG 18 - Heathlands","MVG 19 - Tussock Grasslands","MVG 20 - Hummock Grasslands","MVG 21 - Other Grasslands, Herblands, Sedgelands and Rushlands","MVG 22 - Chenopod Shrublands, Samphire Shrublands and Forblands","MVG 23 - Mangroves","MVG 24 - Inland aquatic - freshwater, salt lakes, lagoons","MVG 25 - Cleared, non-native vegetation, buildings","MVG 26 - Unclassified native vegetation","MVG 27 - Naturally bare - sand, rock, claypan, mudflat","MVG 28 - Sea and estuaries","MVG 29 - Regrowth, modified native vegetation","MVG 99 - Unknown/no data"];

            self.data.nvisSubGroup = ko.observable();
            self.transients.nvisSubGroupConstraints = ["MVS 1 - Cool temperate rainforest","MVS 2 - Tropical or sub-tropical rainforest","MVS 3 - Eucalyptus (+/- tall) open forest with a dense broad-leaved and/or tree-fern understorey (wet sclerophyll)","MVS 4 - Eucalyptus open forests with a shrubby understorey","MVS 5 - Eucalyptus open forests with a grassy understorey","MVS 6 - Warm Temperate Rainforest","MVS 7 - Tropical Eucalyptus forest and woodlands with a tall annual grassy understorey","MVS 8 - Eucalyptus woodlands with a shrubby understorey","MVS 9 - Eucalyptus woodlands with a tussock grass understorey","MVS 10 - Eucalyptus woodlands with a hummock grass understorey","MVS 11 - Tropical mixed spp forests and woodlands","MVS 12 - Callitris forests and woodlands","MVS 13 - Brigalow (Acacia harpophylla) forests and woodlands","MVS 14 - Other Acacia forests and woodlands","MVS 15 - Melaleuca open forests and woodlands","MVS 16 - Other forests and woodlands","MVS 17 - Boulders/rock with algae, lichen or scattered plants, or alpine fjaeldmarks","MVS 18 - Eucalyptus low open woodlands with hummock grass","MVS 19 - Eucalyptus low open woodlands with tussock grass","MVS 20 - Mulga (Acacia aneura) woodlands +/- tussock grass +/- forbs","MVS 21 - Other Acacia tall open shrublands and [tall] shrublands","MVS 22 - Acacia (+/- low) open woodlands and shrublands with chenopods","MVS 23 - Acacia (+/- low) open woodlands and shrublands with hummock grass","MVS 24 - Acacia (+/- low) open woodlands and shrublands +/- tussock grass","MVS 25 - Acacia (+/- low) open woodlands and sparse shrublands with a shrubby understorey","MVS 26 - Casuarina and Allocasuarina forests and woodlands","MVS 27 - Mallee with hummock grass","MVS 28 - Low closed forest or tall closed shrublands (including Acacia, Melaleuca and Banksia)","MVS 29 - Mallee with a dense shrubby understorey","MVS 30 - Heath","MVS 31 - Saltbush and Bluebush shrublands","MVS 32 - Other shrublands","MVS 33 - Hummock grasslands","MVS 34 - Mitchell grass (Astrebla) tussock grasslands","MVS 35 - Blue grass (Dicanthium) and tall bunch grass (Vitiveria syn: Chrysopogon) tussock grasslands","MVS 36 - Temperate tussock grasslands","MVS 37 - Other tussock grasslands","MVS 38 - Wet tussock grassland with herbs, sedges or rushes, herblands or ferns","MVS 39 - Mixed chenopod, samphire +/- forbs","MVS 40 - Mangroves","MVS 41 - Saline or brackish sedgelands or grasslands","MVS 42 - Naturally bare, sand, rock, claypan, mudflat","MVS 43 - Salt lakes and lagoons","MVS 44 - Freshwater, dams, lakes, lagoons or aquatic plants","MVS 45 - Mulga (Acacia aneura) open woodlands and sparse shrublands +/- tussock grass","MVS 46 - Sea, estuaries (includes seagrass)","MVS 47 - Eucalyptus open woodlands with shrubby understorey","MVS 48 - Eucalyptus open woodlands with a grassy understorey","MVS 49 - Melaleuca shrublands and open shrublands","MVS 50 - Banksia woodlands","MVS 51 - Mulga (Acacia aneura) woodlands and shrublands with hummock grass","MVS 52 - Mulga (Acacia aneura) open woodlands and sparse shrublands with hummock grass","MVS 53 - Eucalyptus low open woodlands with a shrubby understorey","MVS 54 - Eucalyptus tall open forest with a fine-leaved shrubby understorey","MVS 55 - Mallee  with an open shrubby understorey","MVS 56 - Eucalyptus (+/- low) open woodlands with a chenopod or samphire understorey","MVS 57 - Lignum shrublands and wetlands","MVS 58 - Leptospermum forests and woodlands","MVS 59 - Eucalyptus woodlands with ferns, herbs, sedges, rushes or wet tussock grassland","MVS 60 - Eucalyptus tall open forests and open forests with ferns, herbs, sedges, rushes or wet tussock grasses","MVS 61 - Mallee with a tussock grass understorey","MVS 62 - Dry rainforest or vine thickets","MVS 63 - Sedgelands, rushs or reeds","MVS 64 - Other grasslands","MVS 65 - Eucalyptus woodlands with a chenopod or samphire understorey","MVS 66 - Open mallee woodlands and sparse mallee shrublands with a hummock grass understorey","MVS 67 - Open mallee woodlands and sparse mallee shrublands with a tussock grass understorey","MVS 68 - Open mallee woodlands and sparse mallee shrublands with an open shrubby understorey","MVS 69 - Open mallee woodlands and sparse mallee shrublands with a dense shrubby understorey","MVS 70 - Callitris open woodlands","MVS 71 - Casuarina and Allocasuarina open woodlands with a tussock grass understorey","MVS 72 - Casuarina and Allocasuarina open woodlands with a hummock grass understorey","MVS 73 - Casuarin-a and Allocasuarina open woodlands with a chenopod shrub understorey","MVS 74 - Casuarina and Allocasuarina open woodlands with a shrubby understorey","MVS 75 - Melaleuca open woodlands","MVS 79 - Other open Woodlands","MVS 80 - Other sparse shrublands and sparse heathlands","MVS 90 - Regrowth or modified forests and woodlands","MVS 91 - Regrowth or modified shrublands","MVS 92 - Regrowth or modified graminoids","MVS 93 - Regrowth or modified chenopod shrublands, samphire or forblands","MVS 96 - Unclassified Forest","MVS 97 - Unclassified native vegetation","MVS 98 - Cleared, non-native vegetation, buildings","MVS 99 - Unknown/No data"];

            self.data.assessmentEventType = ko.observable();
            self.transients.assessmentEventTypeConstraints = ["Initial assessment","Follow-up assessment"];

            self.data.typeOfSite = ko.observable();
            self.transients.typeOfSiteConstraints = ["Control site","Intervention site"];

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['recorderName'](data['recorderName']);
                self.data['transectBearing'](orZero(data['transectBearing']));
                self.data['nvisGroup'](data['nvisGroup']);
                self.data['nvisSubGroup'](data['nvisSubGroup']);
                self.data['assessmentEventType'](data['assessmentEventType']);
                self.data['typeOfSite'](data['typeOfSite']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Sampling Site Information') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSampling_Site_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
        $(function(){

            var viewModelName = "Field_Sheet_1_-_Ground_CoverViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var GroundCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleLocation = ko.observable(orZero(data['sampleLocation']));
            this.numberOfNativePlants = ko.observable(orZero(data['numberOfNativePlants']));
            this.numberOfExoticPlants = ko.observable(orZero(data['numberOfExoticPlants']));
            this.cryptogramPresent = ko.observable(orFalse(data['cryptogramPresent']));
            this.organicLitterPresent = ko.observable(orFalse(data['organicLitterPresent']));
            this.bareGroundPresent = ko.observable(orFalse(data['bareGroundPresent']));
            this.rockPresent = ko.observable(orFalse(data['rockPresent']));
            this.waterPresent = ko.observable(orFalse(data['waterPresent']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Field Sheet 1 - Ground Cover";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.groundCoverSamples = ko.observableArray([]);
            self.selectedgroundCoverSamplesRow = ko.observable();
        

            self.loadgroundCoverSamples = function (data, append) {
                if (!append) {
                    self.data.groundCoverSamples([]);
                }
                if (data === undefined) {
                                        self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":1}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":2}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":3}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":4}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":5}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":6}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":7}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":8}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":9}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":10}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":11}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":12}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":13}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":14}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":15}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":16}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":17}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":18}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":19}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":20}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":21}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":22}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":23}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":24}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":25}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":26}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":27}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":28}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":29}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":30}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":31}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":32}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":33}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":34}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":35}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":36}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":37}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":38}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":39}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":40}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":41}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":42}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":43}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":44}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":45}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":46}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":47}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":48}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":49}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":50}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.groundCoverSamples.push(new GroundCoverSamplesRow(obj));
                    });
                }
            };

            self.addgroundCoverSamplesRow = function () {
                var newRow = new GroundCoverSamplesRow();
                self.data.groundCoverSamples.push(newRow);
                
            };
            self.removegroundCoverSamplesRow = function (row) {
                self.data.groundCoverSamples.remove(row);
                
            };
            self.groundCoverSamplesrowCount = function () {
                return self.data.groundCoverSamples().length;
            };

            self.groundCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showgroundCoverSamplesTableDataUpload = function() {
                self.groundCoverSamplesTableDataUploadVisible(!self.groundCoverSamplesTableDataUploadVisible());
            };

            self.groundCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadgroundCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "groundCoverSamplestemplate-upload",
                    downloadTemplateId: "groundCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 1 - Ground Cover', listName:'groundCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedgroundCoverSamplesRow;
                delete jsData.groundCoverSamplesTableDataUploadOptions
                delete jsData.groundCoverSamplesTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadgroundCoverSamples(data.groundCoverSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 1 - Ground Cover') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_1_-_Ground_Cover"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
        $(function(){

            var viewModelName = "Field_Sheet_2_-_Exotic_FaunaViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var EvidenceOfExoticFaunaRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleLocation = ko.observable(orZero(data['sampleLocation']));
            this.evidence = ko.observable(orBlank(data['evidence']));
            self.transients.evidenceConstraints = ["","Hole","Scats","Live","Tracks","Fur or feathers","Warren","Den","Soil","Scratchings","Damage","Other"];
            this.comment = ko.observable(orBlank(data['comment']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Field Sheet 2 - Exotic Fauna";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.evidenceOfExoticFauna = ko.observableArray([]);
            self.selectedevidenceOfExoticFaunaRow = ko.observable();
        

            self.loadevidenceOfExoticFauna = function (data, append) {
                if (!append) {
                    self.data.evidenceOfExoticFauna([]);
                }
                if (data === undefined) {
                                        self.data.evidenceOfExoticFauna.push(new EvidenceOfExoticFaunaRow({"sampleLocation":"","evidence":"","comment":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.evidenceOfExoticFauna.push(new EvidenceOfExoticFaunaRow(obj));
                    });
                }
            };

            self.addevidenceOfExoticFaunaRow = function () {
                var newRow = new EvidenceOfExoticFaunaRow();
                self.data.evidenceOfExoticFauna.push(newRow);
                
            };
            self.removeevidenceOfExoticFaunaRow = function (row) {
                self.data.evidenceOfExoticFauna.remove(row);
                
            };
            self.evidenceOfExoticFaunarowCount = function () {
                return self.data.evidenceOfExoticFauna().length;
            };

            self.evidenceOfExoticFaunaTableDataUploadVisible = ko.observable(false);
            self.showevidenceOfExoticFaunaTableDataUpload = function() {
                self.evidenceOfExoticFaunaTableDataUploadVisible(!self.evidenceOfExoticFaunaTableDataUploadVisible());
            };

            self.evidenceOfExoticFaunaTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadevidenceOfExoticFauna(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "evidenceOfExoticFaunatemplate-upload",
                    downloadTemplateId: "evidenceOfExoticFaunatemplate-download",
                    formData:{type:'Field Sheet 2 - Exotic Fauna', listName:'evidenceOfExoticFauna'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedevidenceOfExoticFaunaRow;
                delete jsData.evidenceOfExoticFaunaTableDataUploadOptions
                delete jsData.evidenceOfExoticFaunaTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadevidenceOfExoticFauna(data.evidenceOfExoticFauna);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 2 - Exotic Fauna') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_2_-_Exotic_Fauna"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
        $(function(){

            var viewModelName = "Field_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_CoverViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var NativeOverstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var ExoticOverstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var NativeMidstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var ExoticMidstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.nativeOverstoreyCoverSamples = ko.observableArray([]);
            self.selectednativeOverstoreyCoverSamplesRow = ko.observable();
        

            self.loadnativeOverstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.nativeOverstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addnativeOverstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.nativeOverstoreyCoverSamples.push(new NativeOverstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addnativeOverstoreyCoverSamplesRow = function () {
                var newRow = new NativeOverstoreyCoverSamplesRow();
                self.data.nativeOverstoreyCoverSamples.push(newRow);
                
            };
            self.removenativeOverstoreyCoverSamplesRow = function (row) {
                self.data.nativeOverstoreyCoverSamples.remove(row);
                
            };
            self.nativeOverstoreyCoverSamplesrowCount = function () {
                return self.data.nativeOverstoreyCoverSamples().length;
            };

            self.nativeOverstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.shownativeOverstoreyCoverSamplesTableDataUpload = function() {
                self.nativeOverstoreyCoverSamplesTableDataUploadVisible(!self.nativeOverstoreyCoverSamplesTableDataUploadVisible());
            };

            self.nativeOverstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadnativeOverstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "nativeOverstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "nativeOverstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'nativeOverstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNativeOverstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.nativeOverstoreyCoverSamples().length; i++) {
                    var value = self.data.nativeOverstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.exoticOverstoreyCoverSamples = ko.observableArray([]);
            self.selectedexoticOverstoreyCoverSamplesRow = ko.observable();
        

            self.loadexoticOverstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.exoticOverstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addexoticOverstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.exoticOverstoreyCoverSamples.push(new ExoticOverstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addexoticOverstoreyCoverSamplesRow = function () {
                var newRow = new ExoticOverstoreyCoverSamplesRow();
                self.data.exoticOverstoreyCoverSamples.push(newRow);
                
            };
            self.removeexoticOverstoreyCoverSamplesRow = function (row) {
                self.data.exoticOverstoreyCoverSamples.remove(row);
                
            };
            self.exoticOverstoreyCoverSamplesrowCount = function () {
                return self.data.exoticOverstoreyCoverSamples().length;
            };

            self.exoticOverstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showexoticOverstoreyCoverSamplesTableDataUpload = function() {
                self.exoticOverstoreyCoverSamplesTableDataUploadVisible(!self.exoticOverstoreyCoverSamplesTableDataUploadVisible());
            };

            self.exoticOverstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadexoticOverstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "exoticOverstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "exoticOverstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'exoticOverstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalExoticOverstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.exoticOverstoreyCoverSamples().length; i++) {
                    var value = self.data.exoticOverstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.nativeMidstoreyCoverSamples = ko.observableArray([]);
            self.selectednativeMidstoreyCoverSamplesRow = ko.observable();
        

            self.loadnativeMidstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.nativeMidstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addnativeMidstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.nativeMidstoreyCoverSamples.push(new NativeMidstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addnativeMidstoreyCoverSamplesRow = function () {
                var newRow = new NativeMidstoreyCoverSamplesRow();
                self.data.nativeMidstoreyCoverSamples.push(newRow);
                
            };
            self.removenativeMidstoreyCoverSamplesRow = function (row) {
                self.data.nativeMidstoreyCoverSamples.remove(row);
                
            };
            self.nativeMidstoreyCoverSamplesrowCount = function () {
                return self.data.nativeMidstoreyCoverSamples().length;
            };

            self.nativeMidstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.shownativeMidstoreyCoverSamplesTableDataUpload = function() {
                self.nativeMidstoreyCoverSamplesTableDataUploadVisible(!self.nativeMidstoreyCoverSamplesTableDataUploadVisible());
            };

            self.nativeMidstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadnativeMidstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "nativeMidstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "nativeMidstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'nativeMidstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNativeMidstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.nativeMidstoreyCoverSamples().length; i++) {
                    var value = self.data.nativeMidstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.exoticMidstoreyCoverSamples = ko.observableArray([]);
            self.selectedexoticMidstoreyCoverSamplesRow = ko.observable();
        

            self.loadexoticMidstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.exoticMidstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addexoticMidstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.exoticMidstoreyCoverSamples.push(new ExoticMidstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addexoticMidstoreyCoverSamplesRow = function () {
                var newRow = new ExoticMidstoreyCoverSamplesRow();
                self.data.exoticMidstoreyCoverSamples.push(newRow);
                
            };
            self.removeexoticMidstoreyCoverSamplesRow = function (row) {
                self.data.exoticMidstoreyCoverSamples.remove(row);
                
            };
            self.exoticMidstoreyCoverSamplesrowCount = function () {
                return self.data.exoticMidstoreyCoverSamples().length;
            };

            self.exoticMidstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showexoticMidstoreyCoverSamplesTableDataUpload = function() {
                self.exoticMidstoreyCoverSamplesTableDataUploadVisible(!self.exoticMidstoreyCoverSamplesTableDataUploadVisible());
            };

            self.exoticMidstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadexoticMidstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "exoticMidstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "exoticMidstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'exoticMidstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalExoticMidstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.exoticMidstoreyCoverSamples().length; i++) {
                    var value = self.data.exoticMidstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadnativeOverstoreyCoverSamples(data.nativeOverstoreyCoverSamples);
                self.loadexoticOverstoreyCoverSamples(data.exoticOverstoreyCoverSamples);
                self.loadnativeMidstoreyCoverSamples(data.nativeMidstoreyCoverSamples);
                self.loadexoticMidstoreyCoverSamples(data.exoticMidstoreyCoverSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_Cover"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
        $(function(){

            var viewModelName = "Field_Sheet_4_-_Crown_TypeViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var CrownTypeSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleName = ko.observable(orBlank(data['sampleName']));
            this.distanceAlongTransect = ko.observable(orZero(data['distanceAlongTransect']));
            this.crownType = ko.observable(orZero(data['crownType']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Field Sheet 4 - Crown Type";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.crownTypeSamples = ko.observableArray([]);
            self.selectedcrownTypeSamplesRow = ko.observable();
        

            self.loadcrownTypeSamples = function (data, append) {
                if (!append) {
                    self.data.crownTypeSamples([]);
                }
                if (data === undefined) {
                                        self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 1","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 2","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 3","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 4","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 5","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 6","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 7","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 8","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 9","distanceAlongTransect":"","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"sampleName":"Tree canopy 10","distanceAlongTransect":"","crownType":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.crownTypeSamples.push(new CrownTypeSamplesRow(obj));
                    });
                }
            };

            self.addcrownTypeSamplesRow = function () {
                var newRow = new CrownTypeSamplesRow();
                self.data.crownTypeSamples.push(newRow);
                
            };
            self.removecrownTypeSamplesRow = function (row) {
                self.data.crownTypeSamples.remove(row);
                
            };
            self.crownTypeSamplesrowCount = function () {
                return self.data.crownTypeSamples().length;
            };

            self.crownTypeSamplesTableDataUploadVisible = ko.observable(false);
            self.showcrownTypeSamplesTableDataUpload = function() {
                self.crownTypeSamplesTableDataUploadVisible(!self.crownTypeSamplesTableDataUploadVisible());
            };

            self.crownTypeSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadcrownTypeSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "crownTypeSamplestemplate-upload",
                    downloadTemplateId: "crownTypeSamplestemplate-download",
                    formData:{type:'Field Sheet 4 - Crown Type', listName:'crownTypeSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.averageCrownType = ko.computed(function () {
                var total = 0;
                var count = 0;
                for(var i = 0; i < self.data.crownTypeSamples().length; i++) {
                    var value = self.data.crownTypeSamples()[i].crownType();
                        if (!isNaN(parseFloat(value))) {
                                total = total + Number(value);
                                count++;
                        }
                }
                return count > 0 ? total/count : 0;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedcrownTypeSamplesRow;
                delete jsData.crownTypeSamplesTableDataUploadOptions
                delete jsData.crownTypeSamplesTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadcrownTypeSamples(data.crownTypeSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 4 - Crown Type') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_4_-_Crown_Type"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
        $(function(){

            var viewModelName = "Field_Sheet_5_-_Species_DiversityViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SpeciesListRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.nativeOrExotic = ko.observable(orBlank(data['nativeOrExotic']));
            self.transients.nativeOrExoticConstraints = ["Native","Exotic"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Field Sheet 5 - Species Diversity";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.speciesList = ko.observableArray([]);
            self.selectedspeciesListRow = ko.observable();
        

            self.loadspeciesList = function (data, append) {
                if (!append) {
                    self.data.speciesList([]);
                }
                if (data === undefined) {
                    self.addspeciesListRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.speciesList.push(new SpeciesListRow(obj));
                    });
                }
            };

            self.addspeciesListRow = function () {
                var newRow = new SpeciesListRow();
                self.data.speciesList.push(newRow);
                
            };
            self.removespeciesListRow = function (row) {
                self.data.speciesList.remove(row);
                
            };
            self.speciesListrowCount = function () {
                return self.data.speciesList().length;
            };

            self.speciesListTableDataUploadVisible = ko.observable(false);
            self.showspeciesListTableDataUpload = function() {
                self.speciesListTableDataUploadVisible(!self.speciesListTableDataUploadVisible());
            };

            self.speciesListTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadspeciesList(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "speciesListtemplate-upload",
                    downloadTemplateId: "speciesListtemplate-download",
                    formData:{type:'Field Sheet 5 - Species Diversity', listName:'speciesList'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedspeciesListRow;
                delete jsData.speciesListTableDataUploadOptions
                delete jsData.speciesListTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadspeciesList(data.speciesList);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 5 - Species Diversity') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_5_-_Species_Diversity"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };

        this.validate = function() {
            var valid = $('#validation-container').validationEngine('validate');
            if (valid) {
                // Check that forms with multiple optional sections have at least one of those sections completed.
                var optionalCount = 0;
                var notCompletedCount = 0;
                $.each(self.subscribers, function(i, obj) {
                    if (obj.model !== 'activityModel' && obj.model !== 'photoPoints') {
                        if (obj.model.transients.optional) {
                            optionalCount++;
                            if (obj.model.outputNotCompleted()) {
                                notCompletedCount++;
                            }
                        }
                    }
                });
                if (optionalCount > 1 && notCompletedCount == optionalCount) {
                   valid = false;
                   bootbox.alert("<p>To 'Save changes', the mandatory fields of at least one section of this form must be completed.</p>"+
                        "<p>If all sections are 'Not applicable' please contact your grant manager to discuss alternate form options</p>");
                }
            }

            return valid;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         * @return -1 if the page was not modified, 0 if validation failed, 1 if validation succeeded (or was not requested).
         */
        this.save = function (validate) {
            // Ensure any active change is committed - the knockout binding typically fires on blur.
            $( document.activeElement ).blur();

            if (validate === undefined) {
                validate = true;
            }
            var activityData, outputs = [];

            var success = true;
            if (validate) {
                success = self.validate();
            }
            if (!self.isDirty()) {
                mobileBindings.onSaveActivity(-1, null);
                return -1;
            }
            if (success) {
                $.each(this.subscribers, function(i, obj) {
                    if (obj.model === 'activityModel') {
                        activityData = obj.get();
                    } else {
                        outputs.push(obj.get());
                    }
                });

                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                mobileBindings.onSaveActivity(1, toSave);

            }
            else {
                mobileBindings.onSaveActivity(0, null);
            }
            return success?1:0;
        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };

        this.addSite = function(site) {
            var viewModel = ko.dataFor(document.getElementById('site'));
            viewModel.transients.sites.push(site);
            viewModel.siteId(site.siteId);
        }
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        
        
            loadThemes:function(){return "[]"},
        

        supportsNewSite:function() { return true; },
        onSaveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var sites = JSON.parse(mobileBindings.loadSites());
var themes = JSON.parse(mobileBindings.loadThemes());

$(function(){

var scroll = false;

$('#validation-container').validationEngine('attach', {scroll: scroll});

$('.helphover').popover({animation: true, trigger:'hover'});

$('#reset').click(function () {
master.reset();
});

function ViewModel (act, sites, themes) {
var self = this;
var today = new Date().toISOStringNoMillis();

self.activityId = act.activityId;
self.description = ko.observable(act.description);
self.notes = ko.observable(act.notes);
self.startDate = ko.observable(act.startDate || today).extend({simpleDate: false});
self.endDate = ko.observable(act.endDate).extend({simpleDate: false});
self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
self.eventPurpose = ko.observable(act.eventPurpose);
self.fieldNotes = ko.observable(act.fieldNotes);
self.associatedProgram = ko.observable(act.associatedProgram);
self.associatedSubProgram = ko.observable(act.associatedSubProgram);
self.progress = ko.observable(act.progress);
self.mainTheme = ko.observable(act.mainTheme);
self.type = ko.observable(act.type);
self.siteId = ko.observable(act.siteId);
self.projectId = act.projectId;
self.transients = {};
self.transients.sites = ko.observableArray(sites);
self.transients.photoPoints = ko.computed(function() {
    var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
     if (site) {
         return site.photoPoints ? site.photoPoints : site.poi;
     }
     return [];
});
self.transients.activityProgressValues = ['planned','started','finished'];
self.transients.themes = themes?themes:[];
self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
self.transients.markedAsFinished.subscribe(function (finished) {
    self.progress(finished ? 'finished' : 'started');
    if (finished || !self.endDate()) {
        self.endDate(today);
    }
});
self.transients.siteImgUrl = ko.computed(function() {
    if (self.siteId()) {
         var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
         if (site) {
            var lat,lon;
            if (site.centroidLat !== undefined && site.centroidLon !== undefined) {
                lat = site.centroidLat;
                lon = site.centroidLon;
            }
            else if (site.extent && site.extent.geometry && site.extent.geometry.centre) {
                lat = site.extent.geometry.centre[1];
                lon = site.extent.geometry.centre[0];
            }
            if (lat !== undefined && lon !== undefined) {
                $('#siteLocationImage').show();
                return fcConfig.googleStaticUrl+lat+","+lon;
            }
         }
    }
    return "";
});
self.siteLoadError = function(data, event) {
    $('#siteLocationImage').hide();
};

self.transients.newSiteSupported = ko.observable( mobileBindings.supportsNewSite());

self.modelForSaving = function () {
    // get model as a plain javascript object
    var jsData = ko.toJS(self);
    delete jsData.transients;
    return jsData;
};
self.modelAsJSON = function () {
    return JSON.stringify(self.modelForSaving());
};

self.save = function (callback, key) {
};

self.createNewSite = function() {
    mobileBindings.createNewSite();
}

self.notImplemented = function () {
    alert("Not implemented yet.")
};

self.attachPhotoPoint = function(e) {
    console.log(e);
};
self.dirtyFlag = ko.dirtyFlag(self, false);

// make sure progress moves to started if we save any data (unless already finished)
// (do this here so the model becomes dirty)
self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
}


var viewModel = new ViewModel(activity, sites, themes);

ko.applyBindings(viewModel);

master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);


});


</script>
</body>
</html>